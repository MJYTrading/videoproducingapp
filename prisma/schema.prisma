generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:../data/video-producer.db"
}

// ─── Auth ───────────────────────────────────────────────

model User {
  id           String   @id @default(cuid())
  username     String   @unique
  passwordHash String
  createdAt    DateTime @default(now())
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
}

// ─── Settings ───────────────────────────────────────────

model Settings {
  id                    String  @id @default("singleton")
  elevateApiKey         String  @default("")
  n8nBaseUrl            String  @default("https://n8n.srv1275252.hstgr.cloud")
  assemblyAiApiKey      String  @default("")
  discordWebhookUrl     String  @default("")
  discordUserId         String  @default("1154154714699665418")
  openClawUrl           String  @default("http://127.0.0.1:18789")
  openClawHooksToken    String  @default("")
  defaultVoice          String  @default("Brody — Crime Narrator")
  defaultVisualStyle    String  @default("ai-3d-render")
  defaultLanguage       String  @default("EN")
  defaultScriptLength   Int     @default(5000)
  defaultSubtitles      Boolean @default(true)
  defaultColorGrading   String  @default("cinematic_dark")
  youtubeTranscriptApiKey String @default("")
  anthropicApiKey       String  @default("")
  genaiProApiKey        String  @default("")
  genaiProEnabled       Boolean @default(false)
  genaiProImagesEnabled Boolean @default(false)
  videoDownloadApiKey   String  @default("")

  // Extra API keys
  perplexityApiKey      String  @default("")
  twelveLabsApiKey      String  @default("")
  nexlevApiKey          String  @default("")
  youtubeRapidApiKey    String  @default("")
  pexelsApiKey          String  @default("")
}

// ─── Channel ────────────────────────────────────────────

model Channel {
  id            String    @id @default(cuid())
  name          String    @unique
  driveFolderId String    @default("")
  description   String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Basis configuratie
  youtubeChannelId    String  @default("")
  defaultVideoType    String  @default("ai")
  competitors         String  @default("[]")

  // Spokesperson configuratie
  maxClipDurationSeconds Int?

  // Style Profile & Research op kanaal-level
  baseStyleProfile       String?
  baseResearchTemplate   String?
  styleReferenceUrls     String  @default("[]")
  styleExtraInstructions String  @default("")

  // Clip historie
  usedClips String @default("[]")

  // Media presets
  overlayPresetId       String?
  sfxEnabled            Boolean @default(true)
  specialEditsEnabled   Boolean @default(true)

  // Standaard project instellingen
  defaultScriptLengthMinutes Float    @default(8)
  defaultVoiceId             String   @default("")
  defaultOutputFormat        String   @default("youtube-1080p")
  defaultAspectRatio         String   @default("landscape")
  defaultSubtitles           Boolean  @default(true)
  defaultLanguage            String   @default("EN")
  defaultVisualStyle         String   @default("ai-3d-render")
  defaultVisualStyleParent   String?  @default("ai")
  referenceScriptUrls        String   @default("[]")

  // Analytics — RPM (Revenue Per Mille) per kanaal
  rpm                        Float    @default(0)

  // Relaties
  projects              Project[]
  ideas                 Idea[]
  competitorEntries     Competitor[]
  musicSelections       ChannelMusicSelection[]
  sfxSelections         ChannelSfxSelection[]
  specialEditSelections ChannelSpecialEditSelection[]
  editingKnowledge      EditingKnowledge[]
  overlayPreset         OverlayPreset? @relation(fields: [overlayPresetId], references: [id])
  viewSnapshots         ChannelViewSnapshot[]
}

// ─── Channel View Snapshots (per-uur views tracking) ────

model ChannelViewSnapshot {
  id            String   @id @default(cuid())
  channelId     String
  hour          DateTime
  totalViews    Int      @default(0)
  viewsInHour   Int      @default(0)
  createdAt     DateTime @default(now())

  channel       Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)

  @@unique([channelId, hour])
  @@index([channelId])
  @@index([hour])
}

// ─── Project ────────────────────────────────────────────

model Project {
  id                  String    @id @default(cuid())
  name                String
  title               String
  description         String?
  language            String    @default("EN")
  scriptSource        String    @default("new")
  referenceVideos     String    @default("[]")
  scriptLength        Int?
  scriptUrl           String?
  voice               String
  backgroundMusic     Boolean   @default(false)
  visualStyle         String
  visualStyleParent   String?
  customVisualStyle   String?
  imageSelectionMode  String    @default("auto")
  imagesPerScene      Int       @default(1)
  selectedImages      String    @default("[]")
  transitionMode      String    @default("none")
  uniformTransition   String?
  sceneTransitions    String    @default("[]")
  useClips            Boolean   @default(false)
  referenceClips      String    @default("[]")
  montageClips        String    @default("[]")
  stockImages         Boolean   @default(false)
  checkpoints         String    @default("[]")
  feedbackHistory     String    @default("[]")
  colorGrading        String    @default("Geen")
  subtitles           Boolean   @default(true)
  output              String    @default("YouTube 1080p")
  status              String    @default("config")
  startedAt           DateTime?
  completedAt         DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  aspectRatio         String    @default("landscape")
  priority            Int       @default(0)
  queuePosition       Int?
  enabledSteps        String    @default("[]")
  channelId           String?
  driveUrl            String?

  videoType           String    @default("ai")
  subtitleStyle       String    @default("classic")

  channel             Channel?  @relation(fields: [channelId], references: [id])
  steps               Step[]
  logs                LogEntry[]
}

// ─── Pipeline ───────────────────────────────────────────

model Step {
  id             String    @id @default(cuid())
  stepNumber     Int
  name           String
  executor       String
  status         String    @default("waiting")
  duration       Int?
  error          String?
  retryCount     Int       @default(0)
  startedAt      DateTime?
  firstAttemptAt DateTime?
  result         String?
  aiResponse     String?
  attemptNumber  Int       @default(1)
  metadata       String?
  projectId      String
  project        Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  @@unique([projectId, stepNumber])
}

model LogEntry {
  id        String   @id @default(cuid())
  timestamp DateTime @default(now())
  level     String
  step      Int
  source    String
  message   String
  projectId String
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

// ─── Voices ─────────────────────────────────────────────

model Voice {
  id          String   @id @default(cuid())
  name        String
  voiceId     String   @unique
  description String
  language    String
  createdAt   DateTime @default(now())
}

// ─── Ideation ───────────────────────────────────────────

model Idea {
  id              String   @id @default(cuid())
  title           String
  description     String
  videoType       String
  channelId       String
  sourceData      String   @default("{}")
  referenceVideos String   @default("[]")
  status          String   @default("saved")
  projectId       String?
  createdAt       DateTime @default(now())

  channel         Channel  @relation(fields: [channelId], references: [id])
}

// ─── Research Templates ─────────────────────────────────

model ResearchTemplate {
  id          String   @id @default(cuid())
  name        String
  videoType   String
  template    String
  isDefault   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ─── NexLev Data Cache ─────────────────────────────────

model NexLevCache {
  id          String   @id @default(cuid())
  channelId   String
  endpoint    String
  data        String
  fetchedAt   DateTime @default(now())

  @@unique([channelId, endpoint])
  @@index([channelId])
}

// ─── Competitors ───────────────────────────────────────

model Competitor {
  id              String   @id @default(cuid())
  channelId       String
  ytChannelId     String
  name            String   @default("")
  notes           String   @default("")
  cachedAbout     String?
  createdAt       DateTime @default(now())

  channel         Channel  @relation(fields: [channelId], references: [id])

  @@unique([channelId, ytChannelId])
  @@index([channelId])
}

// ─── Clip Library (gedeeld over alle kanalen) ───────────

model AssetClip {
  id            String    @id @default(cuid())
  sourceUrl     String
  videoId       String
  title         String
  startTime     String
  endTime       String
  localPath     String
  thumbnailPath String?
  tags          String    @default("[]")
  description   String
  category      String
  subjects      String    @default("[]")
  mood          String?
  quality       Float?
  timesUsed     Int       @default(0)
  lastUsedAt    DateTime?
  createdAt     DateTime  @default(now())
}

// ─── Music Library ──────────────────────────────────────

model MusicTrack {
  id              String   @id @default(cuid())
  title           String
  filePath        String
  duration        Float
  mood            String   @default("[]")
  genre           String
  bpm             Int?
  energyProfile   String?
  hasVocals       Boolean  @default(false)
  loopable        Boolean  @default(false)
  tags            String   @default("[]")
  createdAt       DateTime @default(now())

  channelSelections ChannelMusicSelection[]
}

model ChannelMusicSelection {
  id           String @id @default(cuid())
  channelId    String
  musicTrackId String

  channel      Channel    @relation(fields: [channelId], references: [id], onDelete: Cascade)
  musicTrack   MusicTrack @relation(fields: [musicTrackId], references: [id], onDelete: Cascade)

  @@unique([channelId, musicTrackId])
}

// ─── Overlay Library ────────────────────────────────────

model OverlayFile {
  id          String   @id @default(cuid())
  name        String
  filePath    String
  resolution  String?
  framerate   Int?
  duration    Float?
  category    String
  tags        String   @default("[]")
  previewUrl  String?
  createdAt   DateTime @default(now())
}

model OverlayPreset {
  id          String   @id @default(cuid())
  name        String
  description String?
  layers      String
  isDefault   Boolean  @default(false)
  createdAt   DateTime @default(now())

  channels    Channel[]
}

// ─── Sound Effects Library ──────────────────────────────

model SoundEffect {
  id          String   @id @default(cuid())
  name        String
  filePath    String
  duration    Float
  category    String
  intensity   String   @default("medium")
  tags        String   @default("[]")
  usageGuide  String?
  createdAt   DateTime @default(now())

  channelSelections ChannelSfxSelection[]
}

model SfxUsageRule {
  id               String   @id @default(cuid())
  name             String
  description      String
  sfxCategory      String
  triggerCondition String
  isDefault        Boolean  @default(false)
  createdAt        DateTime @default(now())
}

model ChannelSfxSelection {
  id            String @id @default(cuid())
  channelId     String
  soundEffectId String

  channel       Channel     @relation(fields: [channelId], references: [id], onDelete: Cascade)
  soundEffect   SoundEffect @relation(fields: [soundEffectId], references: [id], onDelete: Cascade)

  @@unique([channelId, soundEffectId])
}

// ─── Special Edits Library ──────────────────────────────

model SpecialEdit {
  id            String   @id @default(cuid())
  name          String
  description   String
  scriptPath    String
  parameters    String   @default("{}")
  applicableFor String   @default("[]")
  usageGuide    String?
  previewUrl    String?
  createdAt     DateTime @default(now())

  channelSelections ChannelSpecialEditSelection[]
}

model ChannelSpecialEditSelection {
  id            String @id @default(cuid())
  channelId     String
  specialEditId String

  channel       Channel     @relation(fields: [channelId], references: [id], onDelete: Cascade)
  specialEdit   SpecialEdit @relation(fields: [specialEditId], references: [id], onDelete: Cascade)

  @@unique([channelId, specialEditId])
}

// ─── Editing Knowledge ──────────────────────────────────

model EditingKnowledge {
  id            String   @id @default(cuid())
  projectId     String
  videoType     String
  channelId     String
  directorsCut  String
  userFeedback  String?
  effectsUsed   String   @default("[]")
  score         Int?
  createdAt     DateTime @default(now())

  channel       Channel  @relation(fields: [channelId], references: [id])
}

// ─── Asset Images Library ───────────────────────────────

model AssetImage {
  id            String    @id @default(cuid())
  sourceUrl     String
  localPath     String
  thumbnailPath String?
  title         String
  description   String    @default("")
  tags          String    @default("[]")
  category      String    @default("general")
  subjects      String    @default("[]")
  mood          String?
  style         String?
  source        String    @default("pipeline")
  width         Int?
  height        Int?
  fileSize      Int?
  quality       Float?
  timesUsed     Int       @default(0)
  lastUsedAt    DateTime?
  projectId     String?
  createdAt     DateTime  @default(now())
}
